<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>小兔鲜儿 - 新鲜 惠民 快捷!</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <link rel="shortcut icon" href="./favicon.ico">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/register.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_2143783_iq6z4ey5vu.css">
</head>

<body>
<!-- 项部导航 -->
<div class="xtx_topnav">
    <div class="wrapper">
        <!-- 顶部导航 -->
        <ul class="xtx_navs">
            <li>
                <a href="./login.html">请先登录</a>
            </li>
            <li>
                <a href="./register.html">免费注册</a>
            </li>
            <li>
                <a href="./center-order.html">我的订单</a>
            </li>
            <li>
                <a href="./center.html">会员中心</a>
            </li>
            <li>
                <a href="javascript:;">帮助中心</a>
            </li>
            <li>
                <a href="javascript:;">在线客服</a>
            </li>
            <li>
                <a href="javascript:;">
                    <i class="mobile sprites"></i>
                    手机版
                </a>
            </li>
        </ul>
    </div>
</div>
<!-- 头部 -->
<div class="xtx_header">
    <div class="wrapper">
        <!-- 网站Logo -->
        <h1 class="xtx_logo"><a href="/">小兔鲜儿</a></h1>
        <!-- 主导航 -->
        <div class="xtx_navs">
            <ul class="clearfix">
                <li>
                    <a href="./index.html">首页</a>
                </li>
                <li>
                    <a href="./category01.html">生鲜</a>
                </li>
                <li>
                    <a href="./category01.html">美食</a>
                </li>
                <li>
                    <a href="./category01.html">餐厨</a>
                </li>
                <li>
                    <a href="./category01.html">电器</a>
                </li>
                <li>
                    <a href="./category01.html">居家</a>
                </li>
                <li>
                    <a href="./category01.html">洗护</a>
                </li>
                <li>
                    <a href="./category01.html">孕婴</a>
                </li>
                <li>
                    <a href="./category01.html">服装</a>
                </li>
            </ul>
        </div>
        <!-- 站内搜索 -->
        <div class="xtx_search clearfix">
            <!-- 购物车 -->
            <a href="./cart-none.html" class="xtx_search_cart sprites">
                <i>2</i>
            </a>
            <!-- 搜索框 -->
            <div class="xtx_search_wrapper">
                <input type="text" placeholder="搜一搜" onclick="location.href='./search.html'">
            </div>
        </div>
    </div>
</div>
<div class="xtx-wrapper">
    <div class="container">
        <!-- 卡片 -->
        <div class="xtx-card">
            <h3>新用户注册</h3>
            <form class="xtx-form" autocomplete="off">
                <div data-prop="username" class="xtx-form-item">
                    <span class="iconfont icon-zhanghao"></span>
                    <input name="username" type="text" placeholder="设置用户名称">
                    <span class="msg"></span>
                </div>
                <div data-prop="phone" class="xtx-form-item">
                    <span class="iconfont icon-shouji"></span>
                    <input name="phone" type="text" placeholder="输入手机号码  ">
                    <span class="msg"></span>
                </div>
                <div data-prop="code" class="xtx-form-item">
                    <span class="iconfont icon-zhibiaozhushibiaozhu"></span>
                    <input name="code" type="text" placeholder="短信验证码">
                    <span class="msg"></span>
                    <a class="code" href="javascript:;">发送验证码</a>
                </div>
                <div data-prop="password" class="xtx-form-item">
                    <span class="iconfont icon-suo"></span>
                    <input name="password" type="password" placeholder="设置6至20位字母、数字和符号组合">
                    <span class="msg"></span>
                </div>
                <div data-prop="confirm" class="xtx-form-item">
                    <span class="iconfont icon-suo"></span>
                    <input name="confirm" type="password" placeholder="请再次输入上面密码">
                    <span class="msg"></span>
                </div>
                <div class="xtx-form-item pl50">
                    <i class="iconfont icon-queren"></i>
                    已阅读并同意<i>《用户服务协议》</i>
                </div>
                <div class="xtx-form-item">
                    <button class="submit">下一步</button>
                    <!-- <a class="submit" href="javascript:;">下一步</a> -->
                </div>
            </form>
        </div>
    </div>
</div>
<!-- 公共底部 -->
<div class="xtx_footer clearfix">
    <div class="wrapper">
        <!-- 联系我们 -->
        <div class="contact clearfix">
            <dl>
                <dt>客户服务</dt>
                <dd class="chat">在线客服</dd>
                <dd class="feedback">问题反馈</dd>
            </dl>
            <dl>
                <dt>关注我们</dt>
                <dd class="weixin">公众号</dd>
                <dd class="weibo">微博</dd>
            </dl>
            <dl>
                <dt>下载APP</dt>
                <dd class="qrcode">
                    <img src="./uploads/qrcode.jpg">
                </dd>
                <dd class="download">
                    <span>扫描二维码</span>
                    <span>立马下载APP</span>
                    <a href="javascript:;">下载页面</a>
                </dd>
            </dl>
            <dl>
                <dt>服务热线</dt>
                <dd class="hotline">
                    400-0000-000
                    <small>周一至周日 8:00-18:00</small>
                </dd>
            </dl>
        </div>
    </div>
    <!-- 其它 -->
    <div class="extra">
        <div class="wrapper">
            <!-- 口号 -->
            <div class="slogan">
                <a href="javascript:;" class="price">价格亲民</a>
                <a href="javascript:;" class="express">物流快捷</a>
                <a href="javascript:;" class="quality">品质新鲜</a>
            </div>
            <!-- 版权信息 -->
            <div class="copyright">
                <p>
                    <a href="javascript:;">关于我们</a>
                    <a href="javascript:;">帮助中心</a>
                    <a href="javascript:;">售后服务</a>
                    <a href="javascript:;">配送与验收</a>
                    <a href="javascript:;">商务合作</a>
                    <a href="javascript:;">搜索推荐</a>
                    <a href="javascript:;">友情链接</a>
                </p>
                <p>CopyRight &copy; 小兔鲜儿</p>
            </div>
        </div>
    </div>
</div>
<script>
  // 发送短信验证码模块
  const code = document.querySelector('a.code')
  // 用信号量（节流阀）防止反复点击
  let flag = true
  code.addEventListener('click', function () {
    if (flag) { // 防止多次触发
      flag = !flag
      code.innerHTML = `05秒后重新获取`
      let counter = 5

      let timer = setInterval(function () {
        counter--
        code.innerHTML = `0${counter}秒后重新获取`
        if (!counter) {
          clearInterval(timer)
          code.innerHTML = `重新获取`
          flag = !flag
        }
      }, 1000)
    }
  })


  // 验证表单模块
  const userName = document.querySelector('[name=username]')
  // 使用change事件，当表单内容变化才出触发事件
  const reg_name = /^[a-zA-Z0-9-_]{6,10}$/
  userName.addEventListener('change', function () {
    // .call方法，指定this的指向，适合事件监听；立即执行
    // 如果是verify(reg_name)，this的指向就变成了window
    // verify.call(this, reg_name)

    // 调整，为了最后的提交模块，需要能够不依赖this，单独调用函数且取得返回值
    verify(this, reg_name)
  })

  // 新增参数ev，将所有this替换为ev用来明确事件
  function verify(ev, reg) {
    // const msg = document.querySelector('span.msg')
    // HTML中存在多个相同类名，用结构查找，防止覆盖或重复操作
    const msg = ev.nextElementSibling
    if (!reg.test(ev.value)) {
      msg.innerHTML = 'Invalid inputs'
      return false
    }
    msg.innerHTML = '' // 清空输入错误时的警示信息
    return reg.test(ev.value);
  }

  // 手机号验证、短信验证、密码验证，都同上，只需要改变正则表达式即可
  const phone = document.querySelector('[name=phone]')
  const reg_phone = /^1(3\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\d|9[0-35-9])\d{8}$/
  phone.addEventListener('change', function () {
    // verify.call(this, reg_phone)
    verify(this, reg_phone)
  })

  const code_input = document.querySelector('[name=code]') // 发送验证码是a.code，这个是input
  const reg_code = /^\d{6}$/
  code_input.addEventListener('change', function () {
    // verify.call(this, reg_code)
    verify(this, reg_code)
  })

  const pwd = document.querySelector('[name=password]')
  const reg_pwd = /^[a-zA-Z0-9-_]{6,20}$/
  pwd.addEventListener('change', function () {
    // verify.call(this, reg_pwd)
    verify(this, reg_pwd)
  })

  // 二次密码验证
  const confirm = document.querySelector('[name=confirm]')

  function confirmPwd(ev) {
    const msg = ev.nextElementSibling
    if (ev.value !== pwd.value) {
      msg.innerHTML = 'The password is not same as above'
      return false
    }
    msg.innerHTML = ''
    return true
  }

  confirm.addEventListener('change', function () {
    // confirmPwd.call(this)
    confirmPwd(this)
  })

  // 同意协议小按钮
  const agree = document.querySelector('i.icon-queren')
  agree.addEventListener('click', function () {
    agree.classList.toggle('icon-queren2')
  })

  // 提交模块
  const form = document.querySelector('form')
  form.addEventListener('submit', function (e) {

    // 只要一个不返回true，就不允许提交
    if (verify(userName, reg_name) &&
        verify(phone, reg_phone) &&
        verify(code_input, reg_code) &&
        verify(pwd, reg_pwd) &&
        confirmPwd(confirm)) {
      // 判断同意小按钮是否勾选
      // 新知识：用classList.contains('class')来判断是否包含某个类
      if (agree.classList.contains('icon-queren2')) {
        alert('注册成功，即将跳转')
        console.log('111')
        location.href = 'https://apple.com.cn'
      } else {
        e.preventDefault() // 阻止提交
        alert('请勾选用户协议')
      }
    } else {
      e.preventDefault()
      alert('输入信息有误不完整')
    }
  })

</script>
</body>

</html>